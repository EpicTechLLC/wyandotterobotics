<script is:inline>
  if (typeof window !== 'undefined') {
    const script = document.createElement('script');
    script.src = `https://www.googletagmanager.com/gtag/js?id=G-SF6B4NRXLE`;
    script.async = true;
    document.head.appendChild(script);

    script.onload = function () {
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        // eslint-disable-next-line prefer-rest-params
        dataLayer.push(arguments);
      }

      // Get UTM parameters
      const urlParams = new URLSearchParams(window.location.search);
      const utm_source = urlParams.get('utm_source');
      const utm_medium = urlParams.get('utm_medium');
      const utm_id = urlParams.get('utm_id');

      // Force GA4 to recognize UTMs as a new session
      if (utm_source || utm_medium || utm_id) {
        gtag('config', 'G-SF6B4NRXLE', {
          page_path: window.location.pathname + window.location.search,
          session_id: Date.now(), // Forces a new session
        });

        gtag('event', 'utm_tracking', {
          event_category: 'UTM Tracking',
          event_label: window.location.href,
          utm_source: utm_source || '(not set)',
          utm_medium: utm_medium || '(not set)',
          utm_id: utm_id || '(not set)',
        });
      }
    };
  }
</script>
